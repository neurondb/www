<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="560" viewBox="0 0 1200 560" role="img" aria-label="Filtered RAG diagram: retrieve, rerank, filter, generate">
  <defs>
    <linearGradient id="panel" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#0b1220"/>
      <stop offset="1" stop-color="#111827"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="18" stdDeviation="16" flood-color="#000" flood-opacity="0.55"/>
    </filter>
    <marker id="arrow" markerWidth="6" markerHeight="6" refX="6" refY="3" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L6,3 L0,6 Z" fill="#fbbf24"/>
    </marker>
  </defs>

  <rect x="40" y="40" width="1120" height="480" rx="28" fill="url(#panel)" stroke="#334155" filter="url(#shadow)"/>

  <text x="100" y="98" fill="#e2e8f0" font-size="22" font-weight="900"
        font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
    Filtered RAG: quality gates between retrieval and generation
  </text>
  <text x="100" y="128" fill="#94a3b8" font-size="14" font-weight="650"
        font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
    Retrieve broad → rerank accurately → apply policy filters → answer from the survivors.
  </text>

  <!-- Steps -->
  <g font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
    <rect x="110" y="200" width="220" height="96" rx="18" fill="#0f172a" stroke="#22d3ee" stroke-opacity="0.55"/>
    <text x="220" y="238" fill="#e2e8f0" font-size="15" font-weight="900" text-anchor="middle">Retrieve</text>
    <text x="220" y="262" fill="#94a3b8" font-size="12" font-weight="650" text-anchor="middle">top‑20 candidates</text>

    <rect x="390" y="200" width="220" height="96" rx="18" fill="#0f172a" stroke="#a78bfa" stroke-opacity="0.6"/>
    <text x="500" y="238" fill="#e2e8f0" font-size="15" font-weight="900" text-anchor="middle">Rerank</text>
    <text x="500" y="262" fill="#94a3b8" font-size="12" font-weight="650" text-anchor="middle">cross‑encoder / LLM</text>

    <rect x="670" y="200" width="220" height="96" rx="18" fill="#0f172a" stroke="#34d399" stroke-opacity="0.6"/>
    <text x="780" y="238" fill="#e2e8f0" font-size="15" font-weight="900" text-anchor="middle">Filter</text>
    <text x="780" y="262" fill="#94a3b8" font-size="12" font-weight="650" text-anchor="middle">ACL + trust + freshness</text>

    <rect x="950" y="200" width="140" height="96" rx="18" fill="#0f172a" stroke="#fbbf24" stroke-opacity="0.75"/>
    <text x="1020" y="238" fill="#e2e8f0" font-size="15" font-weight="900" text-anchor="middle">Answer</text>
    <text x="1020" y="262" fill="#94a3b8" font-size="12" font-weight="650" text-anchor="middle">top‑k</text>
  </g>

  <!-- arrows -->
  <path d="M330 248 H382" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="1 3" stroke-dashoffset="1" stroke-linecap="round" fill="none" marker-end="url(#arrow)"/>
  <path d="M610 248 H662" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="1 3" stroke-dashoffset="1" stroke-linecap="round" fill="none" marker-end="url(#arrow)"/>
  <path d="M890 248 H942" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="1 3" stroke-dashoffset="1" stroke-linecap="round" fill="none" marker-end="url(#arrow)"/>

  <!-- Candidate list -->
  <g>
    <rect x="120" y="340" width="360" height="140" rx="18" fill="#0b1220" stroke="#334155"/>
    <text x="140" y="372" fill="#e2e8f0" font-size="13" font-weight="900"
          font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
      Candidate chunks (top‑20)
    </text>
    <text x="140" y="402" fill="#94a3b8" font-size="12" font-weight="650"
          font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
      Mixed quality: near‑misses + duplicates + outdated docs
    </text>
    <rect x="140" y="420" width="320" height="10" rx="5" fill="#334155"/>
    <rect x="140" y="440" width="260" height="10" rx="5" fill="#334155"/>
    <rect x="140" y="460" width="300" height="10" rx="5" fill="#334155"/>
  </g>

  <!-- Survivors -->
  <g>
    <rect x="560" y="340" width="520" height="140" rx="18" fill="#0b1220" stroke="#334155"/>
    <text x="580" y="372" fill="#e2e8f0" font-size="13" font-weight="900"
          font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
      Final context (top‑k after rerank + filters)
    </text>
    <text x="580" y="402" fill="#94a3b8" font-size="12" font-weight="650"
          font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
      High‑confidence evidence only (safe to cite)
    </text>
    <rect x="580" y="420" width="470" height="10" rx="5" fill="#22c55e" opacity="0.7"/>
    <rect x="580" y="440" width="410" height="10" rx="5" fill="#22c55e" opacity="0.55"/>
    <rect x="580" y="460" width="450" height="10" rx="5" fill="#22c55e" opacity="0.6"/>
  </g>
</svg>


